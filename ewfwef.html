<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private 2-Way Encrypted Chat</title>

<style>
body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; background: #f5f5f5; }
textarea, input, button { width: 100%; padding: 10px; margin-top: 6px; font-size: 16px; box-sizing: border-box; }
textarea { height: 110px; resize: none; }
label { font-weight: bold; margin-top: 15px; display: block; }
#chat { display: none; }
#error { color: red; margin-top: 5px; }
</style>
</head>
<body>

<h2>Private 2-Way Encrypted Chat</h2>

<div id="login">
    <p>Vendos password për të hyrë:</p>
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Hyr</button>
    <p id="error"></p>
</div>

<div id="chat">
    <label>Text1 (Ti shkruan normal):</label>
    <textarea id="text1"></textarea>

    <label>Text2 (Mesazh i enkriptuar – kopjo & dërgo):</label>
    <textarea id="text2" readonly></textarea>

    <label>Text3 (Ngjit mesazhin e enkriptuar të shokut):</label>
    <textarea id="text3"></textarea>

    <label>Text4 (Dekryptimi i mesazhit):</label>
    <textarea id="text4" readonly></textarea>
</div>

<script>
const CORRECT_PASSWORD = "1234";
let KEY = "";

// XOR encryption / decryption
function xorCrypt(text, key) {
    let result = "";
    for (let i = 0; i < text.length; i++) {
        result += String.fromCharCode(
            text.charCodeAt(i) ^ key.charCodeAt(i % key.length)
        );
    }
    return result;
}

document.addEventListener("DOMContentLoaded", () => {
    const loginBtn = document.getElementById("loginBtn");
    const text1 = document.getElementById("text1");
    const text2 = document.getElementById("text2");
    const text3 = document.getElementById("text3");
    const text4 = document.getElementById("text4");
    const errorMsg = document.getElementById("error");

    loginBtn.addEventListener("click", () => {
        const pass = document.getElementById("password").value;

        if (pass === CORRECT_PASSWORD) {
            KEY = pass;
            document.getElementById("login").style.display = "none";
            document.getElementById("chat").style.display = "block";

            // Ti → Enkriptim
            text1.addEventListener("input", () => {
                const encrypted = btoa(xorCrypt(text1.value, KEY));
                text2.value = encrypted;
            });

            // Shoku → Dekriptim
            text3.addEventListener("input", () => {
                try {
                    const decrypted = xorCrypt(atob(text3.value), KEY);
                    text4.value = decrypted;
                } catch {
                    text4.value = "Mesazh i pavlefshëm";
                }
            });

        } else {
            errorMsg.innerText = "Password gabim!";
        }
    });
});
</script>

</body>
</html>
